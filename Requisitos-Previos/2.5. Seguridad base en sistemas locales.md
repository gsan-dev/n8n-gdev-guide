# 2.5 Seguridad Base en Sistemas Locales

<div style="border: 2px solid #4F8AFA; border-radius: 10px; background: #f0f6ff; padding: 18px; margin-bottom: 24px;">
  <strong>ğŸ¯ Objetivo:</strong> Proveer un conjunto de buenas prÃ¡cticas, configuraciones esenciales y recomendaciones tÃ©cnicas para fortalecer la seguridad de instalaciones locales de <b>n8n</b>. Aunque el entorno sea "local", las automatizaciones pueden involucrar APIs externas, datos personales, integraciones sensibles o credenciales empresariales. Por lo tanto, la seguridad no es opcional, sino estructural.
</div>

---

## ğŸ§± Fundamentos de Seguridad en Instalaciones Locales

### ğŸ” 1. Principio de mÃ­nimo privilegio (Least Privilege)

- Ejecutar los procesos y servicios de n8n con usuarios no privilegiados. Evitar correr n8n como root en sistemas Unix/Linux.
- Asignar permisos estrictamente necesarios a archivos y directorios:
  - Directorios de configuraciÃ³n: `chmod 700`
  - Archivos `.env`, claves API, y tokens: `chmod 600`
- Utilizar entornos de desarrollo aislados: contenedores, mÃ¡quinas virtuales o WSL2, con acceso limitado al resto del sistema.

### ğŸ“‚ 2. ProtecciÃ³n de datos sensibles

- Nunca versionar archivos que contengan credenciales. Usar `.gitignore` para evitar incluir archivos como `.env`, `database.sqlite`, `key.json`, etc.
- Habilitar el cifrado de credenciales integrado de n8n:
  - Usar `N8N_ENCRYPTION_KEY` para encriptar datos sensibles en la base de datos.
  - Generar claves con `openssl rand -hex 32` y almacenarlas de forma segura.
- Activar cifrado en disco si se usa almacenamiento local sensible, como flujos crÃ­ticos o respaldos.

### ğŸŒ 3. Seguridad en la interfaz web

- Aunque el servicio estÃ© corriendo en localhost, evitar accesos no autorizados:
  - Restringir el acceso a `127.0.0.1` o establecer un proxy inverso con autenticaciÃ³n.
  - Implementar autenticaciÃ³n bÃ¡sica o JWT incluso en entornos locales si se comparten redes de desarrollo.
  - No dejar el puerto por defecto (5678) abierto a la red local sin firewall.
- En ambientes colaborativos, emplear `N8N_BASIC_AUTH_USER` y `N8N_BASIC_AUTH_PASSWORD` o `N8N_JWT_AUTH_ACTIVE` con tokens firmados.

### ğŸ§© 4. Seguridad en dependencias y entorno de ejecuciÃ³n

- Validar las versiones de Node.js, Docker y paquetes npm para evitar vulnerabilidades conocidas (consultar CVEs).
- Usar herramientas como:
  - `npm audit` o `yarn audit`
  - `docker scan`
  - `snyk`
- Mantener actualizado n8n y todas las dependencias del entorno.
- Evitar instalaciones globales de paquetes npm que puedan comprometer el sistema operativo.

### ğŸ—‚ï¸ 5. Seguridad en configuraciÃ³n y variables de entorno

- Separar variables de entorno por contexto:
  - `.env.local` (para desarrollo)
  - `.env.staging`, `.env.prod` (para ambientes futuros)
- No compartir archivos `.env` entre usuarios sin cifrado (uso recomendado: `gpg`, `sops` o almacenamiento seguro como Vault).
- Validar valores antes de iniciar el sistema (`dotenv-safe`, validaciones al iniciar n8n).

### ğŸ”„ 6. Control de red y firewalls

- Aislar el entorno de desarrollo en redes internas o privadas.
- Configurar firewall para evitar accesos externos no autorizados (`UFW`, `firewalld`, `iptables`).
- En Windows, desactivar el acceso pÃºblico para el puerto 5678 y permitir solo desde localhost o redes seguras.

### ğŸ§¬ 7. SupervisiÃ³n y logging seguro

- Configurar logs de forma que:
  - No contengan tokens ni datos sensibles (ocultar tokens en consola con variables `N8N_LOG_LEVEL=warn`).
  - Se roten automÃ¡ticamente (ej. `logrotate` en Linux).
  - Se almacenen de forma segura (evitar carpetas compartidas o sincronizadas sin cifrado).
- Monitorear accesos al panel de administraciÃ³n y ejecuciones de flujos.

### ğŸ“¦ 8. Seguridad en contenedores (Docker)

- Usar imÃ¡genes oficiales firmadas de n8n desde Docker Hub (`n8nio/n8n`).
- No ejecutar contenedores con `--privileged` ni montar volÃºmenes sin restricciones.
- Limitar acceso a red y recursos:
  - `--network=internal`
  - `--read-only`
  - `--memory`, `--cpus` para evitar abusos.
- Usar `docker-compose.override.yml` para separar configuraciones locales del archivo base de producciÃ³n.

### ğŸ›¡ï¸ 9. Copias de seguridad y recuperaciÃ³n segura

- Cifrar las copias de seguridad si contienen:
  - Flujos sensibles
  - Credenciales
  - ConfiguraciÃ³n avanzada
- Automatizar backups con control de versiones (timestamped snapshots).
- Guardar backups en medios externos, discos cifrados o servicios protegidos (Nextcloud con WebDAV, por ejemplo).

### ğŸ‘¥ 10. GestiÃ³n de usuarios en entorno colaborativo

- No compartir credenciales entre usuarios.
- Registrar usuarios tÃ©cnicos con roles diferenciados si se activa JWT.
- Si se conecta a servicios externos (PostgreSQL, APIs empresariales, GitHub...), generar tokens por usuario y con permisos mÃ­nimos necesarios.

---

## âœ… Checklist de seguridad para entorno local n8n

| Elemento                                      | Â¿Aplicado? |
|----------------------------------------------|------------|
| Claves encriptadas con `N8N_ENCRYPTION_KEY`  | âœ… / âŒ     |
| Acceso limitado a localhost                  | âœ… / âŒ     |
| AutenticaciÃ³n activada (Basic o JWT)         | âœ… / âŒ     |
| Firewall activo y puerto restringido         | âœ… / âŒ     |
| Variables `.env` fuera de Git y cifradas     | âœ… / âŒ     |
| Logs controlados y sin datos sensibles       | âœ… / âŒ     |
| ImÃ¡genes oficiales y sin privilegios elevados| âœ… / âŒ     |
| Backups cifrados y almacenados de forma segura| âœ… / âŒ     |
| ValidaciÃ³n de dependencias (`npm audit`, `snyk`)| âœ… / âŒ |
| Usuarios tÃ©cnicos separados                  | âœ… / âŒ     |

---

<div style="background: #eaf7ea; border-left: 5px solid #4F8AFA; padding: 14px; margin-bottom: 18px;">
<b>ğŸ“˜ RecomendaciÃ³n final:</b>  
Incluso en contextos locales o de laboratorio, tratar la instancia de n8n como si se estuviera operando en un entorno expuesto. Esto no solo prepara al equipo para un despliegue futuro en producciÃ³n, sino que fortalece una cultura DevSecOps desde el desarrollo inicial.
</div>

---

<div align="center" style="border: 1px solid #4F8AFA; border-radius: 12px; padding: 20px; background: #f0f6ff; margin-top: 32px; display: flex; justify-content: center; gap: 32px;">
  <a href="2.4.%20Recomendaciones%20para%20entorno%20de%20desarrollo%20local.md" style="text-decoration:none; font-weight: bold; color: #4F8AFA; font-size: 1.1em;">â¬…ï¸ Anterior: 2.4 Recomendaciones para entorno de desarrollo local</a>
  <a href="../Metodos-de-Instalacion-Local/3.0.%20Metodos%20de%20instalacion%20Local.md" style="text-decoration:none; font-weight: bold; color: #4F8AFA; font-size: 1.1em;">â¡ï¸ Siguiente: 3.0 MÃ©todos de instalacion Local</a>
</div>

# 7.3 Servicios de correo (SMTP, IMAP, Gmail)

n8n permite integrar servicios de correo electr√≥nico para automatizar flujos relacionados con el env√≠o, recepci√≥n y procesamiento de correos. Esta funcionalidad es esencial para casos como alertas autom√°ticas, clasificaci√≥n de correos, env√≠os masivos o triggers basados en bandejas de entrada.

---

## 7.3.1 Servicios soportados

| **Protocolo** | **Nodos disponibles** | **Usos principales**                  |
|---------------|-----------------------|---------------------------------------|
| **SMTP**      | Email Send           | Enviar correos desde n8n             |
| **IMAP**      | Email Read IMAP      | Leer correos entrantes               |
| **Gmail**     | Gmail, Gmail Trigger | Env√≠o y lectura mediante API de Google |

‚ÑπÔ∏è Otros servicios como Outlook y Office365 tambi√©n son accesibles mediante OAuth2 y nodos HTTP personalizados.

---

## 7.3.2 Configuraci√≥n de credenciales

### SMTP (ej. Gmail, SendGrid, Mailgun)

1. Ir a **Credentials ‚Üí New Credential ‚Üí SMTP**.
2. Ingresar los siguientes par√°metros:

| **Campo**  | **Ejemplo**               |
|------------|---------------------------|
| **Host**   | `smtp.gmail.com`          |
| **Port**   | `587`                     |
| **User**   | `usuario@dominio.com`     |
| **Password** | `app-password` o `token` |
| **Secure** | `true` (STARTTLS)         |

üîê **Recomendado usar contrase√±as de aplicaci√≥n o claves API, no tu contrase√±a personal.**

### IMAP (lectura de correos)

1. Crear credencial de tipo **IMAP Email**.
2. Ejemplo de configuraci√≥n para Gmail:

| **Campo**  | **Ejemplo**               |
|------------|---------------------------|
| **Host**   | `imap.gmail.com`          |
| **Port**   | `993`                     |
| **User**   | `usuario@dominio.com`     |
| **Password** | `app-password`           |
| **SSL/TLS** | `true`                   |

üì® Puedes configurar filtros como etiquetas, fechas, asunto, remitente, etc.

### Gmail API (OAuth2)

1. Ir a **Credentials ‚Üí Google OAuth2 API**.
2. Ingresar **Client ID**, **Client Secret** y scopes:

- `https://www.googleapis.com/auth/gmail.readonly`
- `https://www.googleapis.com/auth/gmail.send`

3. Asociar esta credencial al nodo Gmail.

---

## 7.3.3 Nodos disponibles y sus funciones

| **Nodo**          | **Funci√≥n principal**                                   |
|-------------------|-------------------------------------------------------|
| **Email Send**    | Enviar correos usando SMTP                             |
| **Email Read IMAP** | Leer correos nuevos de una bandeja                    |
| **Gmail**         | Enviar correos v√≠a API de Google                       |
| **Gmail Trigger** | Activar flujo cuando llega un nuevo correo             |

---

## 7.3.4 Casos de uso

| **Caso de uso**              | **Descripci√≥n**                                      |
|------------------------------|----------------------------------------------------|
| **Alertas de sistema**       | Notificar fallos, errores o cambios por email.     |
| **Env√≠o autom√°tico de reportes** | Programar correos con archivos adjuntos.          |
| **Clasificaci√≥n de correos entrantes** | Leer asunto y aplicar l√≥gica para reenviar o archivar. |
| **Verificaci√≥n de correos**  | Automatizar respuestas para validaciones de registros. |
| **Atenci√≥n al cliente**      | Extraer datos de correos entrantes y asignar tareas. |

---

## 7.3.5 Uso de expresiones y adjuntos

Es posible personalizar el contenido del correo con expresiones din√°micas:

```plaintext
Hola {{$json["nombre"]}}, su orden {{$json["ordenId"]}} ha sido enviada.
```

Tambi√©n se puede adjuntar archivos generados por otros nodos (Spreadsheet, PDF, HTML, etc.) con el campo **Attachments**.

---

## 7.3.6 Recomendaciones de seguridad

- üìß Usa SMTP autenticado con contrase√±a de aplicaci√≥n.
- üîê Siempre cifra la conexi√≥n (STARTTLS o SSL).
- üö´ Evita poner direcciones de destino como hardcoded; usa variables.
- üì• Para lectura IMAP, evita sincronizar carpetas enteras sin filtros.

---

## 7.3.7 Errores comunes

| **Error**                | **Causa**                     | **Soluci√≥n**                                      |
|--------------------------|-------------------------------|--------------------------------------------------|
| **Invalid credentials**  | Usuario o clave err√≥nea       | Verifica credenciales y permisos                 |
| **535 Authentication failed** | SMTP mal configurado         | Usar puerto correcto y TLS                       |
| **Connection timeout**   | Red bloqueada o puerto incorrecto | Revisar firewall o ISP                          |
| **Quota exceeded**       | L√≠mite de env√≠o diario alcanzado | Aplicar reintentos o usar otro remitente         |

---

## 7.3.8 Mejores pr√°cticas

- ‚úÖ Usa etiquetas (**labels**) para clasificar correos entrantes.
- üïí Agenda tareas de env√≠o con nodos **Cron**.
- üìå Mant√©n separadas credenciales de lectura y escritura.
- üìä Registra los correos enviados con un nodo **Database** o **Google Sheets**.
- üß™ Testea el env√≠o con direcciones de prueba antes de producci√≥n.

---

<div align="center" style="border: 1px solid #4F8AFA; border-radius: 12px; padding: 20px; background: #f0f6ff; margin-top: 32px; display: flex; justify-content: center; gap: 32px;">
  <a href="7.2.%20Conexi√≥n%20a%20bases%20de%20datos%20(PostgreSQL,%20MySQL,%20SQLite).md" style="text-decoration:none; font-weight: bold; color: #4F8AFA; font-size: 1.1em;">‚¨ÖÔ∏è Anterior: 7.2 Conexi√≥n a bases de datos</a>
  <a href="7.4.%20Google%20Workspace,%20Microsoft%20365.md" style="text-decoration:none; font-weight: bold; color: #4F8AFA; font-size: 1.1em;">‚û°Ô∏è Siguiente: 7.4 Google Workspace, Microsoft 365</a>
</div>

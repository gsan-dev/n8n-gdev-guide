# 7.1 Conexi√≥n a APIs externas (REST/SOAP)

n8n permite integrarse de forma sencilla y robusta con APIs externas, ya sea REST o SOAP, lo que lo convierte en una plataforma altamente flexible para la automatizaci√≥n de procesos empresariales. Esta funcionalidad es clave para conectar sistemas heterog√©neos sin necesidad de desarrollar integraciones complejas.

---

## 7.1.1 Uso del nodo HTTP Request

El nodo **HTTP Request** es la herramienta principal para realizar peticiones a servicios RESTful o SOAP.

### Configuraci√≥n general:

| **Campo**         | **Descripci√≥n**                                                                 |
|--------------------|-------------------------------------------------------------------------------|
| **HTTP Method**    | Selecciona GET, POST, PUT, PATCH, DELETE, etc.                                |
| **URL**            | Introduce la URL del endpoint (puede incluir par√°metros din√°micos usando expresiones de n8n). |
| **Authentication** | Define si requiere autenticaci√≥n (API Key, Basic Auth, OAuth2, etc.).         |
| **Headers**        | A√±ade cabeceras como Content-Type, Authorization, etc.                        |
| **Body**           | En POST o PUT, especifica el contenido en JSON, XML o formulario.             |

---

## 7.1.2 Autenticaci√≥n con APIs

n8n permite gestionar diferentes tipos de autenticaci√≥n nativamente:

- **API Key:** incluida en headers o par√°metros.
- **Basic Auth:** usuario y contrase√±a.
- **OAuth2:** n8n ofrece gesti√≥n integrada del flujo OAuth2 para servicios como Google, GitHub, Slack, etc.
- **Bearer Token:** usado com√∫nmente en APIs modernas RESTful.

**Ejemplo de autenticaci√≥n con API Key:**

```json
{
  "headers": {
    "x-api-key": "tu_clave_aqui"
  }
}
```

---

## 7.1.3 Conexi√≥n a servicios SOAP

Aunque n8n est√° m√°s orientado a REST, puedes consumir servicios SOAP utilizando el nodo **HTTP Request** enviando contenido XML estructurado.

### Requisitos para SOAP:

- **M√©todo:** POST
- **Header:** Content-Type: text/xml
- **Body:** estructura del envelope SOAP
- **Endpoint:** URL del servicio WSDL

**Ejemplo de configuraci√≥n b√°sica:**

```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:web="http://webservice.ejemplo.com/">
   <soapenv:Header/>
   <soapenv:Body>
      <web:getDatos>
         <web:id>1234</web:id>
      </web:getDatos>
   </soapenv:Body>
</soapenv:Envelope>
```

---

## 7.1.4 Uso de credenciales compartidas

Puedes guardar credenciales reutilizables en:

- **Settings ‚Üí Credentials**

As√≠ puedes centralizar las configuraciones de autenticaci√≥n y usarlas en m√∫ltiples nodos sin duplicar informaci√≥n.

---

## 7.1.5 Manejo de errores en llamadas API

- Valida los c√≥digos de respuesta (2xx, 4xx, 5xx) usando nodos **IF** para redirigir el flujo seg√∫n el resultado.
- Habilita la opci√≥n **‚ÄúContinue On Fail‚Äù** para evitar que el flujo se detenga por errores temporales.
- Usa nodos **Error Trigger** para gestionar de forma centralizada los fallos en API externas.

---

## 7.1.6 Buenas pr√°cticas al consumir APIs

| **Recomendaci√≥n**                              | **Motivo**                                                                 |
|-----------------------------------------------|---------------------------------------------------------------------------|
| üîÑ **Limitar las peticiones (Rate Limit)**     | Para evitar bloqueos por exceder l√≠mites del proveedor.                  |
| üîê **Usar variables de entorno para claves API** | Mejora la seguridad y portabilidad.                                      |
| üìä **Registrar los logs de respuesta**         | Facilita auditor√≠a y debugging.                                          |
| üß™ **Probar con Postman antes de integrar**    | Permite validar la estructura y la l√≥gica de la API.                     |

---

## 7.1.7 Ejemplo pr√°ctico: integraci√≥n con una API REST

**Objetivo:** Obtener informaci√≥n meteorol√≥gica desde OpenWeatherMap.

1. Crear nodo **HTTP Request**.
2. **M√©todo:** GET
3. **URL:**

```bash
https://api.openweathermap.org/data/2.5/weather?q=Madrid&appid={{ $env.OPENWEATHER_API_KEY }}
```

4. **Headers:** Content-Type: application/json
5. Guardar y probar.

---

<div align="center" style="border: 1px solid #4F8AFA; border-radius: 12px; padding: 20px; background: #f0f6ff; margin-top: 32px; display: flex; justify-content: center; gap: 32px;">
  <a href="../Flujos-Automatizados-Creaci√≥n-y-Gesti√≥n/6.6.%20Versionado%20y%20clonaci√≥n%20de%20flujos.md" style="text-decoration:none; font-weight: bold; color: #4F8AFA; font-size: 1.1em;">‚¨ÖÔ∏è Anterior: 6.6 Versionado y clonaci√≥n de flujos</a>
  <a href="7.2.%20Conexi√≥n%20a%20bases%20de%20datos%20(PostgreSQL,%20MySQL,%20SQLite).md" style="text-decoration:none; font-weight: bold; color: #4F8AFA; font-size: 1.1em;">‚û°Ô∏è Siguiente: 7.2 Conexi√≥n a bases de datos</a>
</div>

# 5.3 Mapeo de datos entre nodos (Data Mapping & Expressions)

El **mapeo de datos** entre nodos en n8n es el proceso mediante el cual se transfieren, transforman y adaptan los datos de salida de un nodo para que sean utilizados por otro nodo subsecuente. Esta operaci√≥n es esencial para asegurar la integridad de la l√≥gica de negocio y la continuidad del flujo de trabajo.

n8n utiliza un sistema de **expressions** basado en JavaScript para realizar esta tarea de forma flexible, segura y din√°mica.

---

## 5.3.1 ¬øQu√© es una Expression?

Una **Expression** es una cadena especial que comienza con `=` e interpreta el contenido como una expresi√≥n JavaScript. Estas expresiones permiten acceder a los datos previos en el flujo, manipularlos y utilizarlos como entradas para otros nodos.

**Ejemplo:**

```javascript
={{ $json["email"] }}
```

Este fragmento accede al valor de la propiedad `email` del JSON recibido por el nodo actual.

---

## 5.3.2 Estructura de acceso a datos

n8n proporciona variables contextuales clave para el mapeo de datos:

| **Variable**         | **Prop√≥sito**                                                                 |
|-----------------------|-----------------------------------------------------------------------------|
| `$json`              | Accede al cuerpo del JSON del nodo anterior.                               |
| `$node["NOMBRE_DEL_NODO"].json` | Permite acceder directamente al resultado de otro nodo por su nombre. |
| `$item`              | Representa el item actual procesado en un flujo tipo batch.                 |
| `$binary`            | Accede a datos binarios (im√°genes, PDF, etc.) del nodo anterior.            |
| `$env`               | Accede a variables de entorno configuradas previamente.                     |
| `$parameter`         | Referencia otros par√°metros del mismo nodo.                                 |

---

## 5.3.3 Casos comunes de mapeo

### ‚úÖ Mapear campo directamente desde nodo anterior

```javascript
={{ $json["firstName"] }}
```

### ‚úÖ Concatenar valores

```javascript
={{ $json["firstName"] + " " + $json["lastName"] }}
```

### ‚úÖ Acceder a un nodo anterior espec√≠fico

```javascript
={{ $node["Obtener Usuario"].json["email"] }}
```

### ‚úÖ Utilizar fecha actual

```javascript
={{ new Date().toISOString() }}
```

---

## 5.3.4 Funciones √∫tiles dentro de expressions

| **Funci√≥n JavaScript** | **Ejemplo de uso**                                                        |
|-------------------------|---------------------------------------------------------------------------|
| `.toUpperCase()`        | `={{ $json["nombre"].toUpperCase() }}`                                  |
| `.replace("a", "b")`   | `={{ $json["texto"].replace("error", "correcto") }}`                |
| `JSON.stringify()`      | `={{ JSON.stringify($json) }}`                                           |
| `new Date().toLocaleDateString()` | Devuelve la fecha actual en formato local.                      |

---

## 5.3.5 Acceso a m√∫ltiples items en nodos tipo loop

Cuando un nodo procesa m√∫ltiples √≠tems (por ejemplo, un array), se puede usar `$item` y `$items` para acceder al contexto completo de cada √≠tem.

```javascript
={{ $item(0).$json["id"] }}
```

---

## 5.3.6 Uso de expressions en campos del UI

La interfaz de usuario permite insertar expressions en cualquier campo de tipo input. Al introducir `=`, se activa el editor de expresiones:

- **Icono de l√°piz**: Entrada manual.
- **Icono de f√≥rmula (fx)**: Expresi√≥n din√°mica.
- **Icono de engranaje**: Opciones avanzadas y prueba de expresi√≥n.

---

## 5.3.7 Buenas pr√°cticas de mapeo de datos

- ‚úÖ **Nombres de nodos claros**: Facilita el acceso con `$node["Nombre Nodo"]`.
- ‚úÖ **Validar las expresiones** con "Preview" antes de activar el flujo.
- ‚úÖ **Usar nodos de transformaci√≥n** (`Set`, `Function`, `IF`) para preparar los datos.
- üö´ **Evitar expresiones largas** en campos cr√≠ticos; priorizar claridad sobre concisi√≥n.
- ‚úÖ **Documentar l√≥gica compleja** con nodos de comentario (`Add Note`).

---

## 5.3.8 Ejemplo pr√°ctico de expresi√≥n combinada

**Objetivo:** Construir una URL din√°mica con par√°metros:

```javascript
={{ "https://api.miempresa.com/usuario?id=" + $json["id"] + "&estado=" + $json["activo"] }}
```

---

## 5.3.9 Consideraciones de seguridad

- Las expressions no deben incluir valores sensibles codificados directamente (evitar hardcoding de contrase√±as o tokens).
- Para valores cr√≠ticos, utilizar variables de entorno (`$env`) o nodos de credenciales.

---

<div align="center" style="border: 1px solid #4F8AFA; border-radius: 12px; padding: 20px; background: #f0f6ff; margin-top: 32px; display: flex; justify-content: center; gap: 32px;">
  <a href="5.2.%20Tipos%20de%20nodos.md" style="text-decoration:none; font-weight: bold; color: #4F8AFA; font-size: 1.1em;">‚¨ÖÔ∏è Anterior: 5.2 Tipos de nodos</a>
  <a href="5.4.%20Ejecuci√≥n%20paso%20a%20paso%20y%20depuraci√≥n.md" style="text-decoration:none; font-weight: bold; color: #4F8AFA; font-size: 1.1em;">‚û°Ô∏è Siguiente: 5.4 Ejecuci√≥n paso a paso y depuraci√≥n</a>
</div>